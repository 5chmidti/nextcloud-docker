version: '3'

services:
  pihole:
    container_name: pihole
    #domainname: homedomain.lan
    
    image: pihole/pihole:latest
    dns:
      - 127.0.0.1
      - 1.1.1.1
    ports:
      - '0.0.0.0:53:53/tcp'
      - '0.0.0.0:53:53/udp'
      - '0.0.0.0:67:67/udp'
      - '0.0.0.0:8053:80/tcp'
    volumes:
      - ./etc-pihole/:/etc/pihole/
      - ./etc-dnsmasqd/:/etc/dnsmasq.d/
      # run `touch ./pihole.log` first unless you like errors
      # - ./pihole.log:/var/log/pihole.log
    environment:
      ServerIP: 192.168.178.46
      PROXY_LOCATION: pihole
      #VIRTUAL_HOST: pihole.homedomain.lan
      #VIRTUAL_PORT: 80
      DNS1: 1.1.1.1
      DNS2: 1.0.0.1
      TZ: 'Europe/Berlin'
      WEBPASSWORD: abcd
    restart: unless-stopped
    labels:
       # required when using --docker.exposedbydefault=false
       - "traefik.enable=true"
       - "traefik.frontend.rule=PathPrefixStrip:/pihole"
       - "traefik.frontend.priority=1"
       - "traefik.docker.network=discovery"
       - "traefik.backend=pihole"
       - "traefik.port=80"  

networks:
  # Discovery is manually created to avoid forcing any order of docker-compose stack creation (`docker network create discovery`)
  # allows other compose files to be seen by proxy
  # Not required if you aren't using multiple docker-compose files...
  discovery:
    external: true